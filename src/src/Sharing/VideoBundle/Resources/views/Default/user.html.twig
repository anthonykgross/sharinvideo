{% extends 'SharingVideoBundle::base.html.twig' %}

{% block body %} 
    <div class="intro">
        <div class="container">
            <div class="row">
                <div id="screen">
                    <div id="mediaplayer">Loading the player ...</div>
                </div>
                <div class="col-lg-12" style="text-align: center;">
                    <label for="sync">Synchronize</label>
                    <input type="checkbox" checked="checked" id="sync" /> 
                </div>
                <div class="col-lg-12">
                    <label>History</label>
                    <ul id="message"></ul>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
        var master = '{{user}}';
        var synchronization = true;

        $(function(){
            $("#sync").on('click', function () {
                synchronization = $(this).is(':checked');
            });
        });

        socket.emit('slave_ready', {master: master});

        socket.on('message', function(message){
            newMessage(message);
        });

        socket.on('new_video', function(j){
            refreshYoutubePlayer(j.url);
        });

        socket.on('event_change', function(j){
            if(synchronization){
                if(j && player){
                    if(j.event==='onPlay'){
                        player.playVideo();
                    }
                    if(j.event==='onPause'){
                        player.pauseVideo();
                    }
                    if(j.event==='onBuffer'){
                        player.seekTo(j.seconds);
                        player.playVideo();
                    }
                    if(j.event==='onTime'){
                        var currentTime = player.getCurrentTime();

                        if(currentTime < j.seconds-(delay/2) || currentTime > j.seconds+(delay/2)) {
                            player.seekTo(j.seconds);
                        }
                    }
                }
            }
        });

        function onPlayerStateChange(event) {
            if(event.data === 2) {
                socket.emit('slave_wait', {master: master});
            }
            if(event.data === 3) {
                socket.emit('slave_wait', {master: master});
            }
        }

    </script>
{% endblock %}